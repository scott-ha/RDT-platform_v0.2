{"version":3,"sources":["../../src/client/WiggleClientEngine.js"],"names":["WiggleClientEngine","gameEngine","options","WiggleRenderer","on","obj","playerId","document","body","classList","add","querySelector","disabled","window","location","reload","addEventListener","mouseX","mouseY","updateMouseXY","bind","sendMouseAngle","e","preventDefault","touches","item","pageX","pageY","player","world","queryObject","y","W_speed","x","W_dir","sendInput","directionStop","movement","a","Math","atan2","isNaN","d","angle","W_fr","ClientEngine"],"mappings":";;;;;;;AAAA;;AACA;;;;;;;;;;;;;;;;;;;;;;IAEqBA,kB;;;;;AAEjB,8BAAYC,UAAZ,EAAwBC,OAAxB,EAAiC;AAAA;;AAAA;;AAC7B,4FAAMD,UAAN,EAAkBC,OAAlB,EAA2BC,uBAA3B,GAD6B,CAG7B;;AACAF,IAAAA,UAAU,CAACG,EAAX,CAAc,iBAAd,EAAiC,UAACC,GAAD,EAAS;AACtC,UAAIA,GAAG,CAACC,QAAJ,KAAiBL,UAAU,CAACK,QAAhC,EAA0C;AACtCC,QAAAA,QAAQ,CAACC,IAAT,CAAcC,SAAd,CAAwBC,GAAxB,CAA4B,UAA5B;AACAH,QAAAA,QAAQ,CAACI,aAAT,CAAuB,WAAvB,EAAoCC,QAApC,GAA+C,KAA/C,CAFsC,CAGtC;;AACAC,QAAAA,MAAM,CAACC,QAAP,CAAgBC,MAAhB,GAJsC,CAKtC;AACH;AACJ,KARD,EAJ6B,CAc7B;;AACAR,IAAAA,QAAQ,CAACI,aAAT,CAAuB,WAAvB,EAAoCK,gBAApC,CAAqD,OAArD,EAA8D,YAAM;AAChEH,MAAAA,MAAM,CAACC,QAAP,CAAgBC,MAAhB;AACH,KAFD;AAIA,UAAKE,MAAL,GAAc,IAAd;AACA,UAAKC,MAAL,GAAc,IAAd;AAEAX,IAAAA,QAAQ,CAACS,gBAAT,CAA0B,WAA1B,EAAuC,MAAKG,aAAL,CAAmBC,IAAnB,+BAAvC,EAAsE,KAAtE;AACAb,IAAAA,QAAQ,CAACS,gBAAT,CAA0B,YAA1B,EAAwC,MAAKG,aAAL,CAAmBC,IAAnB,+BAAxC,EAAuE,KAAvE;AACAb,IAAAA,QAAQ,CAACS,gBAAT,CAA0B,WAA1B,EAAuC,MAAKG,aAAL,CAAmBC,IAAnB,+BAAvC,EAAsE,KAAtE;AACAb,IAAAA,QAAQ,CAACS,gBAAT,CAA0B,YAA1B,EAAwC,MAAKG,aAAL,CAAmBC,IAAnB,+BAAxC,EAAuE,KAAvE;;AACA,UAAKnB,UAAL,CAAgBG,EAAhB,CAAmB,iBAAnB,EAAsC,MAAKiB,cAAL,CAAoBD,IAApB,+BAAtC;;AA1B6B;AA2BhC;;;;kCAEaE,C,EAAG;AACbA,MAAAA,CAAC,CAACC,cAAF;AACA,UAAID,CAAC,CAACE,OAAN,EAAeF,CAAC,GAAGA,CAAC,CAACE,OAAF,CAAUC,IAAV,CAAe,CAAf,CAAJ;AACf,WAAKR,MAAL,GAAcK,CAAC,CAACI,KAAhB;AACA,WAAKR,MAAL,GAAcI,CAAC,CAACK,KAAhB;AACH;;;qCAEgB;AACb,UAAIC,MAAM,GAAG,KAAK3B,UAAL,CAAgB4B,KAAhB,CAAsBC,WAAtB,CAAkC;AAAExB,QAAAA,QAAQ,EAAE,KAAKL,UAAL,CAAgBK;AAA5B,OAAlC,CAAb,CADa,CAGb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA,UAAIsB,MAAM,KAAK,IAAf,EAAqB;AACjB;AACH,OApBY,CAqBb;;;AACA,UAAIG,CAAC,GAAGlB,MAAM,CAACmB,OAAf;AACA,UAAIC,CAAC,GAAGpB,MAAM,CAACqB,KAAf;;AACA,UAAIH,CAAC,GAAG,EAAR,EAAY;AACR,aAAKI,SAAL,CAAe,KAAKlC,UAAL,CAAgBmC,aAA/B,EAA8C;AAAEC,UAAAA,QAAQ,EAAE;AAAZ,SAA9C;AACA;AACH;;AACDN,MAAAA,CAAC,GAAGA,CAAC,GAAG,EAAR;AACA,UAAIO,CAAC,GAAGC,IAAI,CAACC,KAAL,CAAWT,CAAX,EAAcE,CAAd,CAAR;;AACA,UAAIQ,KAAK,CAACH,CAAD,CAAT,EAAc;AACV,aAAKH,SAAL,CAAe,KAAKlC,UAAL,CAAgBmC,aAA/B,EAA8C;AAAEC,UAAAA,QAAQ,EAAE;AAAZ,SAA9C;AACA,eAFU,CAEF;AACX;;AACD,UAAIK,CAAC,GAAGJ,CAAC,GAAG,CAAZ;AACA,UAAIK,KAAK,GAAG,OAAOD,CAAnB,CAnCa,CAmCS;;AAEtB7B,MAAAA,MAAM,CAAC+B,IAAP,GAAcD,KAAd;AAEA,WAAKR,SAAL,CAAeQ,KAAf,EAAsB;AAAEN,QAAAA,QAAQ,EAAE;AAAZ,OAAtB,EAvCa,CAwCb;AACH;;;;EA/E2CQ,qB","sourcesContent":["import { ClientEngine } from 'lance-gg';\nimport WiggleRenderer from '../client/WiggleRenderer';\n\nexport default class WiggleClientEngine extends ClientEngine {\n\n    constructor(gameEngine, options) {\n        super(gameEngine, options, WiggleRenderer);\n\n        // show try-again button\n        gameEngine.on('objectDestroyed', (obj) => {\n            if (obj.playerId === gameEngine.playerId) {\n                document.body.classList.add('lostGame');\n                document.querySelector('#tryAgain').disabled = false;\n                //---- kong ----\n                window.location.reload();\n                //----\n            }\n        });\n\n        // restart game\n        document.querySelector('#tryAgain').addEventListener('click', () => {\n            window.location.reload();\n        });\n\n        this.mouseX = null;\n        this.mouseY = null;\n\n        document.addEventListener('mousemove', this.updateMouseXY.bind(this), false);\n        document.addEventListener('mouseenter', this.updateMouseXY.bind(this), false);\n        document.addEventListener('touchmove', this.updateMouseXY.bind(this), false);\n        document.addEventListener('touchenter', this.updateMouseXY.bind(this), false);\n        this.gameEngine.on('client__preStep', this.sendMouseAngle.bind(this));\n    }\n\n    updateMouseXY(e) {\n        e.preventDefault();\n        if (e.touches) e = e.touches.item(0);\n        this.mouseX = e.pageX;\n        this.mouseY = e.pageY;\n    }\n\n    sendMouseAngle() {\n        let player = this.gameEngine.world.queryObject({ playerId: this.gameEngine.playerId });\n\n        //---- kong ----\n        //if (this.mouseY === null || player === null) return;\n        //let mouseX = (this.mouseX - document.body.clientWidth/2) / this.zoom;\n        //let mouseY = (this.mouseY - document.body.clientHeight/2) / this.zoom;\n        //let dx = mouseY - player.position.y;\n        //let dy = mouseX - player.position.x;\n        //if (Math.sqrt(dx * dx + dy * dy) < 0.5) {\n        //    this.sendInput(this.gameEngine.directionStop, { movement: true });\n        //    return;\n        //}\n        //let angle = Math.atan2(dx, dy);\n        //this.sendInput(angle, { movement: true });\n        //----\n\n        //---- kong ----\n        if (player === null) {\n            return;\n        }\n        //window.W_fr += 1;\n        let y = window.W_speed;\n        let x = window.W_dir;\n        if (y < 70) {\n            this.sendInput(this.gameEngine.directionStop, { movement: true });\n            return;\n        }\n        y = y / 70;\n        let a = Math.atan2(y, x);\n        if (isNaN(a)) {\n            this.sendInput(this.gameEngine.directionStop, { movement: true });\n            return; // why a is NaN ???\n        }\n        let d = a * 2;\n        let angle = 1.57 - d; // 1.57 is the radian value of 90 degrees\n\n        window.W_fr = angle;\n        \n        this.sendInput(angle, { movement: true });\n        //----\n    }\n}\n"],"file":"WiggleClientEngine.js"}